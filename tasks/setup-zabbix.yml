---
- name: Install PHP for PostgreSQL
  ansible.builtin.apt:
    name: php8.2-pgsql
    state: present
    update_cache: yes
  when: zabbix_database == "pgsql"

- name: Install Zabbix packages
  ansible.builtin.apt:
    name:
      - nginx
      - "zabbix-server-{{ zabbix_database }}"
      - zabbix-frontend-php
      - "zabbix-{{ zabbix_webserver }}-conf"
      - zabbix-sql-scripts
      - zabbix-agent
    state: present
    update_cache: yes

- name: Create Zabbix configuration file
  ansible.builtin.template:
    src: zabbix_server.conf.j2
    dest: /etc/zabbix/zabbix_server.conf
    owner: root
    group: root
    mode: '0600'

- name: Create nginx configuration for Zabbix
  ansible.builtin.template:
    src: nginx.conf.j2
    dest: /etc/zabbix/nginx.conf
    owner: root
    group: root
    mode: '0644'

- name: Generate en_US locale
  ansible.builtin.locale_gen:
    name: en_US.UTF-8
    state: present

- name: Set system-wide locale
  ansible.builtin.shell: update-locale LANG=en_US.UTF-8
